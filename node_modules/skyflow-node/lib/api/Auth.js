"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _axios = _interopRequireDefault(require("axios"));

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));

var Auth = {
  getAccessToken: function getAccessToken() {
    try {
      var credentialsObj = this.credentials;
      var claims = {
        "iss": credentialsObj.clientID,
        "key": credentialsObj.keyID,
        "aud": credentialsObj.tokenURI,
        "exp": Math.floor(Date.now() / 1000) + 60,
        "sub": credentialsObj.clientID
      };
      var privateKey = credentialsObj.privateKey.toString("utf8");

      var signedJwt = _jsonwebtoken.default.sign(claims, privateKey, {
        algorithm: 'RS256'
      });

      return _axios.default.post(credentialsObj.tokenURI, {
        'grant_type': 'urn:ietf:params:oauth:grant-type:jwt-bearer',
        'assertion': signedJwt
      }, {
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(function (res) {
        return res.data;
      }).catch(function (err) {
        console.log(err);
      });
    } catch (e) {
      console.log(e);
    }
  }
};
var _default = Auth;
exports.default = _default;